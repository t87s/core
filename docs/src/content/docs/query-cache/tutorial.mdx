---
title: Tutorial
description: A full flow, end to end
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

A tiny app with users, posts, and comments. Enough to show the shape without making you regret reading docs.

<Tabs>
  <TabItem label="TypeScript">
    ```typescript
    import { QueryCache, at, wild, MemoryAdapter } from '@t87s/core';

    const schema = at('users', () =>
      wild.at('posts', () => wild.at('comments', () => wild))
    );

    const cache = QueryCache({
      schema,
      adapter: new MemoryAdapter(),
      queries: (tags) => ({
        getUser: (id: string) => ({
          tags: [tags.users(id)],
          fn: () => db.users.findById(id),
        }),
        getPost: (userId: string, postId: string) => ({
          tags: [tags.users(userId).posts(postId)],
          fn: () => db.posts.findById(postId),
        }),
      }),
    });

    await cache.getUser('123');
    await cache.getPost('123', 'p1');
    await cache.invalidate(cache.tags.users('123'));

    await cache.primitives.set('stats:users', stats, {
      tags: [['users']],
      ttl: '5m',
    });
    ```
  </TabItem>
  <TabItem label="Python">
    ```python
    from t87s import QueryCache, TagSchema, Wild, cached
    from t87s.adapters import AsyncMemoryAdapter

    class Tags(TagSchema):
        users: Wild["Users"]

    class Users(TagSchema):
        posts: Wild["Posts"]

    class Posts(TagSchema):
        comments: Wild[TagSchema]

    class Cache(QueryCache[Tags]):
        @cached(Tags.users())
        async def get_user(self, id: str):
            return await db.users.find_by_id(id)

        @cached(Tags.users().posts())
        async def get_post(self, user_id: str, post_id: str):
            return await db.posts.find_by_id(post_id)

    cache = Cache(adapter=AsyncMemoryAdapter())

    await cache.get_user("123")
    await cache.get_post("123", "p1")
    await cache.invalidate(cache.t.users("123"))

    await cache.primitives.set(
        "stats:users",
        stats,
        tags=[("users",)],
        ttl="5m",
    )
    ```
  </TabItem>
</Tabs>

That's the whole loop. Query, invalidate, repeat. The rest is just scale.
