---
title: Prefix Matching
description: Parents take the fall so children can be fast
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

When you invalidate a tag, everything below it goes stale too. It's family drama, but useful.

<Tabs>
  <TabItem label="TypeScript">
    ```typescript
    import { QueryCache, at, wild, MemoryAdapter } from '@t87s/core';

    const schema = at('users', () => wild.at('posts', () => wild));

    const cache = QueryCache({
      schema,
      adapter: new MemoryAdapter(),
      queries: (tags) => ({
        getUser: (id: string) => ({
          tags: [tags.users(id)],
          fn: () => db.users.findById(id),
        }),
        getPost: (userId: string, postId: string) => ({
          tags: [tags.users(userId).posts(postId)],
          fn: () => db.posts.findById(postId),
        }),
      }),
    });

    await cache.invalidate(cache.tags.users('123'));
    // Invalidates users:123 and users:123:posts:*
    ```
  </TabItem>
  <TabItem label="Python">
    ```python
    from t87s import QueryCache, TagSchema, Wild, cached
    from t87s.adapters import AsyncMemoryAdapter

    class Tags(TagSchema):
        users: Wild["Users"]

    class Users(TagSchema):
        posts: Wild[TagSchema]

    class Cache(QueryCache[Tags]):
        @cached(Tags.users())
        async def get_user(self, id: str):
            return await db.users.find_by_id(id)

        @cached(Tags.users().posts())
        async def get_post(self, user_id: str, post_id: str):
            return await db.posts.find_by_id(post_id)

    cache = Cache(adapter=AsyncMemoryAdapter())

    await cache.invalidate(cache.t.users("123"))
    # Invalidates users:123 and users:123:posts:*
    ```
  </TabItem>
</Tabs>

If you really want only the exact tag, TypeScript lets you do `cache.invalidate(tag, true)` or drop to primitives. Python will follow soon.
