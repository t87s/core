---
title: API Reference
description: Complete API documentation for t87s
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

## T87s Class

### Constructor

<Tabs>
  <TabItem label="TypeScript">
    ```typescript
    new T87s(options: T87sOptions)
    ```
  </TabItem>
  <TabItem label="Python">
    ```python
    T87s(adapter, prefix="t87s", default_ttl="30s", default_grace=None)
    ```
  </TabItem>
</Tabs>

**Options:**

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `adapter` | `StorageAdapter` | required | Storage backend |
| `prefix` | `string` | `'t87s'` | Key prefix for namespacing |
| `defaultTtl` / `default_ttl` | `string \| number` | `'30s'` | Default TTL for queries |
| `defaultGrace` / `default_grace` | `string \| number \| None` | `None` | Default grace period |

### query()

<Tabs>
  <TabItem label="TypeScript">
    ```typescript
    t87s.query<TArgs, TResult>(
      factory: (...args: TArgs) => QueryConfig<TResult>
    ): (...args: TArgs) => Promise<TResult>
    ```
  </TabItem>
  <TabItem label="Python">
    ```python
    @t87s.query
    def my_query(args...) -> QueryConfig[T]:
        return QueryConfig(tags=[...], fn=lambda: ...)
    ```
  </TabItem>
</Tabs>

Creates a cached query function.

**QueryConfig:**

| Option | Type | Required | Description |
|--------|------|----------|-------------|
| `tags` | `Tag[]` / `list[Tag]` | required | Cache dependencies |
| `fn` | `() => Promise<T>` / `Callable[[], T]` | required | Data fetcher |
| `ttl` | `string \| number` | optional | Time to live |
| `grace` | `string \| number \| false` / `str \| int \| None` | optional | Grace period |

### mutation()

<Tabs>
  <TabItem label="TypeScript">
    ```typescript
    t87s.mutation<TArgs, TResult>(
      fn: (...args: TArgs) => Promise<MutationResult<TResult>>
    ): (...args: TArgs) => Promise<TResult>
    ```
  </TabItem>
  <TabItem label="Python">
    ```python
    @t87s.mutation
    def my_mutation(args...) -> MutationResult[T]:
        return MutationResult(result=..., invalidates=[...])
    ```
  </TabItem>
</Tabs>

Creates a mutation that invalidates cache.

**MutationResult:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `result` | `T` | required | Return value |
| `invalidates` | `Tag[]` / `list[Tag]` | required | Tags to invalidate |
| `exact` | `boolean` / `bool` | optional | Disable prefix matching |

### invalidate()

<Tabs>
  <TabItem label="TypeScript">
    ```typescript
    t87s.invalidate(tags: Tag[], exact?: boolean): Promise<void>
    ```
  </TabItem>
  <TabItem label="Python">
    ```python
    t87s.invalidate(tags: list[Tag], exact: bool = False) -> None
    ```
  </TabItem>
</Tabs>

Manually invalidate tags without a mutation.

### clear()

<Tabs>
  <TabItem label="TypeScript">
    ```typescript
    t87s.clear(): Promise<void>
    ```
  </TabItem>
  <TabItem label="Python">
    ```python
    t87s.clear() -> None
    ```
  </TabItem>
</Tabs>

Clear all cached data.

## defineTags() / define_tags()

<Tabs>
  <TabItem label="TypeScript">
    ```typescript
    defineTags<T extends TagDefinitions>(defs: T): TagFactories<T>
    ```

    Creates typed tag factories.

    ```typescript
    const tags = defineTags({
      user: (id: string) => ['user', id],
    });

    const tag = tags.user('123'); // Type: Tag
    ```
  </TabItem>
  <TabItem label="Python">
    ```python
    define_tags(defs: dict[str, Callable[..., tuple[str, ...]]]) -> dict[str, Callable[..., Tag]]
    ```

    Creates tag factories.

    ```python
    tags = define_tags({
        "user": lambda id: ("user", id),
    })

    tag = tags["user"]("123")  # Type: Tag
    ```
  </TabItem>
</Tabs>
